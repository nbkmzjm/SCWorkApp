
doctype html
html(lang="en")
	head
		title Jade Page
		meta(charset='UTF-8')
		link(rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.css")
		link(rel="stylesheet" type="text/css" href="css/style.css")


	body
		#container

		

			//- table#main
			//- 	- var test = users
			//- 	p#test= test 
			//- 	tr
			//- 		td= 'User'
			//- 		- for (var i=4; i < 14 ; i++)
			//- 			td= dateHeader[i].dateH
			//- 	- for (var i=0; i< users.length; i++)
			//- 		tr
			//- 			td= users[i].email
						//- - for (var e=0; e< 14; e++)
							if (typeof assigns[9] == "undefined")
								td= a
							else 

								assigns [e].datePos == e && assigns[e].user.email == users[i].email) 
								td= assigns[e].Note
						



			


	a(href='/assignInput') Assign Input
	br
	a(href='/logout') Logout

			


			
		script(src="public/js/jquery-2.1.4.min.js")
		script(src="public/js/socket.io-1.3.7.js")
		script(src="public/js/app.js")
		script.

			$(function onload(){
				
							

		
				$.post('/ajaxUser').done(mainSC);

				//- $.post('/mainSC', { postdata:{name: "John", time: "2pm" }}).done(function(data){
				//- 	alert(data.dateHeader[0].dateH);
				//- 	alert(data.users[0].email);
				//- 	})
			});

			function mainSC(data){

				var users = data.users;
				var arrListDateSC = [];
				var dateSC = new Date();
				var container = $('#container');
				var table = document.createElement('table');
					table.setAttribute('id', 'main');
					table.setAttribute('class','table')
					var tr1 = document.createElement('tr');
						var td = document.createElement('td');
							td.appendChild(document.createTextNode('User'));
						tr1.appendChild(td);
						for (var i=0; i<7; i++){
							dateSC.setDate(dateSC.getDate()+1);
							var td = document.createElement('td');
							td.appendChild(document.createTextNode(dateSC.toDateString()));
							tr1.appendChild(td);
							}
					table.appendChild(tr1);
				var dateSC = new Date();

				for (var i=0; i< users.length; i++){
					var tr = document.createElement('tr');
						var td = document.createElement('td');
							td.appendChild(document.createTextNode(users[i].email));
						//- tr.appendChild(td);

						//- var x = 0;
						//- var y = 3
						//- function delayLoop(){
						//- 	if (x++ < 3){return;}
						//- 		console.log(x);
						//- 	window.setTimeout(delayLoop, 1000);
								
						//- }
						//- delayLoop();


					    for (var x=0; x<2; x++){
						
						    dateSC.setDate(dateSC.getDate()+1);

						 //-    var td = document.createElement('td');
							//- 			td.setAttribute('class','cell')
							//- 			td.appendChild(document.createTextNode(''));

							//- tr.appendChild(td);

							var taskSCData = {};
							taskSCData.userId = users[i].id;
							taskSCData.dateSC = dateSC.toLocaleDateString();

							arrListDateSC.push(taskSCData);
						}
						
					table.appendChild(tr);
					var dateSC = new Date();
				}
				alert(JSON.stringify(arrListDateSC, null, 4));
				var i = 1;
				var loopArrayDateSC = function(arr){
				//- alert(arr[i].userId+ arr[i].dateSC);


					$.post('/taskSC', {postdata:{userId: arr[i].userId, dateSC:arr[i].dateSC}}).done(
						function(assigndata){

							if(!!assigndata.assign){
								dateSC.setDate(dateSC.getDate()+1);
								
								var userId = assigndata.assign.userId;
								var taskSC = assigndata.assign.Note;
								//- alert(userId + '--' + taskSC);

								var td = document.createElement('td');
									td.setAttribute('class','cell')
									td.appendChild(document.createTextNode(taskSC));
									td.addEventListener('click',function(userId,dateSC){

										return function(){
											var taskSC = $('input[name=PTO]:checked').attr('value');

											$.post('/dateSC', {postdata:{userId: userId, dateSC:dateSC, taskSC:taskSC}});
											//- .done(test
												//- function(data){
												//- 	alert(JSON.stringify(data, null, 4))
											this.style.backgroundColor = 'yellow'
											this.innerHTML=taskSC;
												//- }
											//- );
											
										}
									
									//- alert('clicked: '+ x);

									}(userId, dateSC.toLocaleDateString()));

								
								

								//- if (arr[i].userId != arr[i-1].userId){
								//- 	var tr = document.createElement('tr');
								//- 	tr.appendChild(td);
								//- 	table.appendChild(tr);
									
									
								//- }else{
									tr.appendChild(td);
								//- }
														
							} else {
								//- alert('no assigndata');
								
								dateSC.setDate(dateSC.getDate()+1);

								var userId = assigndata.userId;
								

								var td = document.createElement('td');
									td.setAttribute('class','cell')
									td.appendChild(document.createTextNode(""));
									td.addEventListener('click',function(userId,dateSC){

										return function(){
														
											var taskSC = $('input[name=PTO]:checked').attr('value');

											$.post('/dateSC', {postdata:{userId: userId, dateSC:dateSC, taskSC:taskSC}});
											//- .done(test
												//- function(data){
												//- 	alert(JSON.stringify(data, null, 4))
											this.style.backgroundColor = 'yellow'
											this.innerHTML=taskSC;
												//- }
											//- );
											
										}
									
									

									}(userId, dateSC.toLocaleDateString()));
									
								
							tr.appendChild(td);
							}

						}
							
					);


				//- alert(arr[i].userId + '--' + arr[i-1].userId );
				if (arr[i].userId != arr[i-1].userId){
					alert(arr[i].userId + '--' + arr[i-1].userId );
					var tr1 = document.createElement('tr');
					tr1.appendChild(td);
					//- table.appendChild(tr);
				
				} else{
					alert(arr[i].userId + '--' + arr[i-1].userId );
					tr.appendChild(td);
				}

				i++;
				if (i < arr.length ){
					loopArrayDateSC(arr);
				}

				}

				loopArrayDateSC(arrListDateSC);
				table.appendChild(tr);
				table.appendChild(tr1);
				container.append(table);


				var ul = document.createElement('ul');
				ul.setAttribute('id','PTORadio')
				var li = document.createElement('li');
					var radio = document.createElement('input');
						radio.setAttribute('type','radio');
						radio.setAttribute('name','PTO');
						radio.setAttribute('value','PTO');
						radio.setAttribute('checked','checked');
					li.appendChild(radio);
					li.appendChild(document.createTextNode('PTO'));
					
				var li1 = document.createElement('li');
					var radio = document.createElement('input');
						radio.setAttribute('type','radio');
						radio.setAttribute('name','PTO');
						radio.setAttribute('value','PTOR');
					li1.appendChild(radio);
					li1.appendChild(document.createTextNode('PTOR'));
				ul.appendChild(li);
				ul.appendChild(li1);


				container.append(ul);
			}

			

		

			



			//- alert(arrListTaskSC[2].userId);
			

			


			

			

